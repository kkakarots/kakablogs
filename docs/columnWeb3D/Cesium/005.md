## 简介
使用`Cesium`与前后端实时通信技术（WebSocket等）实现实时轨迹效果，适用于`船舶/飞机`实时位置显示，轨迹追踪。

## 效果截图
<img src="./images/实时轨迹.png" style="margin: 0 auto;">


## 实现-mars3d

在使用`mars3d SDK`时，实现的方式比较简单，有以下几种实例对象都支持添加动态位置：

- BasePointEntity/BasePointPrimitive
- BillboardEntity/BillboardPrimitive
- PointEntity/PointPrimitive
- ModelEntity/ModelPrimitive
- LabelEntity/LabelPrimitive
- Route

`仅LabelPrimitive、PointPrimitive、BillboardPrimitive、ModelPrimitive 等部分子类支持`

``` js
/**
 * 添加动态位置
 * @param point LngLatPoint | Cesium.Cartesian3 | Array.<number>
 * @param currTime Cesium.JulianDate | Date | string | number
 */
graphic.addDynamicPosition(point, currTime)
```

## 实现-cesium GPT:


每次更新时，点的位置是直接设置的，所以点会“闪到”新位置，而不是平滑地移动到新位置。如果你想要点平滑地移动到新位置，可以使用 Cesium 的 `SampledPositionProperty` 来实现平滑的动画效果。下面是如何修改代码来实现平滑移动的示例：

### 1. **使用 `SampledPositionProperty` 实现平滑移动**

`SampledPositionProperty` 允许你为实体设置一系列的时间和位置，从而使实体在这些位置之间平滑过渡。

### 示例代码

```javascript
import Cesium from 'cesium/Cesium';
import 'cesium/Widgets/widgets.css';

// 创建 Cesium 视图
const viewer = new Cesium.Viewer('cesiumContainer');

// 创建一个空的 CZML 数据源
const czmlDataSource = new Cesium.CzmlDataSource();
viewer.dataSources.add(czmlDataSource);

// 创建一个空的实体集合
const entities = {};

// 初始化 WebSocket 连接
const socket = new WebSocket('wss://your-websocket-server');

// 监听 WebSocket 消息
socket.onmessage = function(event) {
    // 解析接收到的消息
    const data = JSON.parse(event.data);

    // 解析位置信息和时间信息
    const { id, position, time } = data;

    // 确保 ID 对应的实体存在
    let entity = entities[id];
    if (!entity) {
        // 创建新的实体，并初始化位置属性为 SampledPositionProperty
        const positionProperty = new Cesium.SampledPositionProperty();
        
        entity = czmlDataSource.entities.add({
            id: id,
            position: positionProperty,
            point: {
                pixelSize: 10,
                color: Cesium.Color.RED
            }
        });

        entities[id] = entity;
    }
    
    // 更新 SampledPositionProperty
    const positionProperty = entity.position;
    
    const julianDate = Cesium.JulianDate.fromIso8601(time);
    positionProperty.addSample(julianDate, Cesium.Cartesian3.fromDegrees(position.longitude, position.latitude));
};
```

### 说明

1. **`SampledPositionProperty`**：创建一个 `SampledPositionProperty` 实例来存储时间和位置数据。每当接收到新数据时，就将新的位置和时间添加到这个属性中。

2. **平滑过渡**：Cesium 会自动平滑地插值这些位置数据，使得点在更新过程中看起来是平滑移动的，而不是突然跳转到新位置。

3. **添加样本**：使用 `positionProperty.addSample(time, position)` 方法将新的位置数据添加到 `SampledPositionProperty` 中，其中 `time` 是 `JulianDate` 对象，`position` 是 `Cartesian3` 坐标。

### 注意事项

- **时间间隔**：确保你添加的位置样本有合适的时间间隔，以确保动画平滑。频繁的更新可能会导致动画卡顿或不流畅。
- **性能**：实时更新和动画可能会对性能产生影响，特别是在处理大量数据时。优化数据传输和处理逻辑可以改善性能。

通过这种方法，你可以实现点在 Cesium 中的平滑移动效果，使得点在更新时不会突然跳跃，而是平滑地过渡到新位置。
